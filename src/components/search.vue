<template>
  <!-- 搜索建议 -->
  <div class="search-prop" v-if="isSearchProp">
    <div class="search-header search-div">搜"{{ keyword }}"相关用户></div>
    <div class="search-body">
      <!-- 单曲 -->
      <div class="search-sing" v-if="getSongs.length > 0">
        <span class="search-left">
          <span class="search-title">
            <svg
              t="1650425261904"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="3403"
              width="12"
              height="12"
            >
              <path
                d="M875.52 433.152q-7.168-1.024-12.8-10.24t-8.704-33.792q-5.12-39.936-26.112-58.88t-65.024-27.136q-46.08-9.216-81.408-37.376t-58.88-52.736q-22.528-21.504-34.816-15.36t-12.288 22.528l0 44.032 0 96.256q0 57.344-0.512 123.904t-0.512 125.952l0 104.448 0 58.368q1.024 24.576-7.68 54.784t-32.768 56.832-64 45.568-99.328 22.016q-60.416 3.072-109.056-21.504t-75.264-61.952-26.112-81.92 38.4-83.456 81.92-54.272 84.992-16.896 73.216 5.632 47.616 13.312l0-289.792q0-120.832 1.024-272.384 0-29.696 15.36-48.64t40.96-22.016q21.504-3.072 35.328 8.704t28.16 32.768 35.328 47.616 56.832 52.224q30.72 23.552 53.76 33.792t43.008 18.944 39.424 20.992 43.008 39.936q23.552 26.624 28.672 55.296t0.512 52.224-14.848 38.4-17.408 13.824z"
                p-id="3404"
                fill="#777777"
              ></path>
            </svg>
            单曲
          </span>
        </span>
        <span class="search-right">
          <span
            class="search-info search-span"
            v-for="item in getSongs"
            :key="item.id"
          >
            <span slot="title" class="artist-name" v-html="byShow(item)"></span>
          </span>
        </span>
      </div>
      <!-- 歌手 -->
      <div class="search-sing" v-if="getArtists.length > 0">
        <span class="search-left">
          <span class="search-title">
            <svg
              t="1650426744755"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="4540"
              width="12"
              height="12"
            >
              <path
                d="M508.8 141.21c119.85 0 217.36 97.51 217.36 217.36S628.65 575.93 508.8 575.93s-217.36-97.51-217.36-217.36 97.51-217.36 217.36-217.36m0-76.71c-162.41 0-294.07 131.66-294.07 294.07S346.39 652.64 508.8 652.64s294.07-131.66 294.07-294.07S671.21 64.5 508.8 64.5z"
                p-id="4541"
                fill="#777777"
              ></path>
              <path
                d="M106.1 959.5c-2.21 0-4.46-0.19-6.71-0.59-20.86-3.68-34.79-23.58-31.11-44.44 38.81-219.89 255.93-338.54 440.52-338.54 21.18 0 38.36 17.17 38.36 38.36s-17.17 38.36-38.36 38.36c-122.34 0-329.6 74.7-364.97 275.17-3.28 18.59-19.47 31.68-37.73 31.68z"
                p-id="4542"
                fill="#777777"
              ></path>
              <path
                d="M917.9 959.5c-18.27 0-34.45-13.09-37.73-31.7-35.38-200.46-242.64-275.16-364.97-275.16-21.18 0-38.36-17.17-38.36-38.36s17.17-38.36 38.36-38.36c184.59 0 401.72 118.65 440.52 338.54 3.68 20.86-10.25 40.76-31.11 44.44-2.25 0.41-4.5 0.6-6.71 0.6z"
                p-id="4543"
                fill="#777777"
              ></path>
            </svg>
            歌手
          </span>
        </span>
        <span class="search-right">
          <span
            class="search-info search-span"
            v-for="item in getArtists"
            :key="item.id"
          >
            <span slot="title" class="artist-name" v-html="byShow(item)"></span>
          </span>
        </span>
      </div>
      <!-- 专辑 -->
      <div class="search-sing" v-if="getArtists.length > 0">
        <span class="search-left">
          <span class="search-title">
            <svg
              t="1650434151835"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="5467"
              width="12"
              height="12"
            >
              <path
                d="M510.413364 958.171736c-246.768243 0-447.517383-200.762443-447.517383-447.524546 0-246.75494 200.74914-447.50408 447.517383-447.50408 246.75494 0 447.517383 200.74914 447.517383 447.50408C957.930747 757.408269 757.168304 958.171736 510.413364 958.171736zM510.413364 118.616538c-216.174458 0-392.044978 175.87052-392.044978 392.031675 0 216.181621 175.869496 392.052141 392.044978 392.052141 216.175481 0 392.043954-175.869496 392.043954-392.052141C902.457318 294.487058 726.588845 118.616538 510.413364 118.616538z"
                p-id="5468"
                fill="#777777"
              ></path>
              <path
                d="M510.413364 614.929254c-57.503669 0-104.282065-46.778396-104.282065-104.282065 0-57.503669 46.777373-104.282065 104.282065-104.282065s104.281041 46.777373 104.281041 104.282065C614.694405 568.150858 567.917032 614.929254 510.413364 614.929254zM510.413364 461.838553c-26.924209 0-48.809659 21.898753-48.809659 48.809659s21.88545 48.809659 48.809659 48.809659c26.909883 0 48.808636-21.898753 48.808636-48.809659S537.323247 461.838553 510.413364 461.838553z"
                p-id="5469"
                fill="#777777"
              ></path>
              <path
                d="M186.517509 542.419823c-7.366781 0-13.489222-7.083326-13.840216-14.518668-0.243547-5.281283-0.36532-11.254322-0.36532-16.604166 0-7.665587 6.203282-14.193257 13.867846-14.193257 7.652284 0 13.867846 6.040576 13.867846 13.706163 0 4.915963 0.10847 11.024078 0.338714 15.872502 0.352017 7.664563-5.552459 15.736403-13.20372 15.736403C186.950368 542.419823 186.733427 542.419823 186.517509 542.419823z"
                p-id="5470"
                fill="#777777"
              ></path>
              <path
                d="M350.727455 806.786886c-2.315742 0-4.659113-0.569982-6.825452-1.787716-88.694041-50.326199-149.44773-136.561235-166.688393-236.603743-1.300622-7.55814 3.764744-14.722306 11.308557-16.021905 7.624654-1.312902 14.721283 3.765767 16.020882 11.30958 15.818267 91.834568 71.602781 170.972976 153.037489 217.181391 6.662747 3.76679 9.006118 12.242835 5.227048 18.906605C360.247272 804.266483 355.561553 806.786886 350.727455 806.786886z"
                p-id="5471"
                fill="#777777"
              ></path>
              <path
                d="M330.819033 693.351348c-3.588735 0-7.17747-1.38351-9.886161-4.145413-41.157375-41.881876-63.814398-97.259114-63.814398-155.968238 0-7.665587 6.203282-13.867846 13.867846-13.867846 7.65126 0 13.867846 6.202259 13.867846 13.867846 0 51.381228 19.839861 99.865475 55.865355 136.520303 5.363148 5.471618 5.281283 14.247492-0.176009 19.609617C337.848123 692.023096 334.325903 693.351348 330.819033 693.351348z"
                p-id="5472"
                fill="#777777"
              ></path>
              <path
                d="M376.865765 728.751602c-2.315742 0-4.672416-0.595564-6.825452-1.813299-4.483104-2.545986-8.871041-5.228071-13.163811-8.099469-6.364965-4.225231-8.098445-12.8384-3.858888-19.203364 4.251837-6.392594 12.8384-8.153704 19.230993-3.874237 3.738138 2.492774 7.570419 4.821819 11.484565 7.070023 6.66377 3.764744 8.992815 12.243859 5.214768 18.906605C386.385583 726.234269 381.699863 728.751602 376.865765 728.751602z"
                p-id="5473"
                fill="#777777"
              ></path>
              <path
                d="M395.568732 647.852084c-2.315742 0-4.672416-0.581238-6.825452-1.802042-34.981722-19.839861-56.704466-57.110719-56.704466-97.278557 0-7.664563 6.203282-13.867846 13.867846-13.867846 7.652284 0 13.867846 6.203282 13.867846 13.867846 0 30.201859 16.33299 58.235332 42.647309 73.145927 6.662747 3.778046 8.992815 12.243859 5.213745 18.906605C405.08855 645.333728 400.389528 647.852084 395.568732 647.852084z"
                p-id="5474"
                fill="#777777"
              ></path>
              <path
                d="M826.888202 547.8106c-0.541329 0-1.096984-0.028653-1.639337-0.096191-7.611352-0.893346-13.05534-7.78736-12.161994-15.397688 13.069667-110.959138-34.669614-220.887806-124.56911-286.910499-6.175653-4.523013-7.501858-13.204743-2.978844-19.380396 4.524037-6.161327 13.218046-7.502881 19.392676-2.965541 97.931426 71.900563 149.936871 191.647855 135.702682 312.50748C839.808466 542.623461 833.821101 547.8106 826.888202 547.8106z"
                p-id="5475"
                fill="#777777"
              ></path>
              <path
                d="M748.486574 522.700713c-0.541329 0-1.083681-0.025583-1.638313-0.094144-7.611352-0.89437-13.042037-7.78736-12.148691-15.398712 8.207939-69.638033-21.751397-138.63957-78.17036-180.068122-6.175653-4.523013-7.503904-13.204743-2.979868-19.379373 4.523013-6.16235 13.20372-7.502881 19.393699-2.965541 64.465221 47.319725 98.67537 126.126582 89.302909 205.665103C761.406838 517.513574 755.42152 522.700713 748.486574 522.700713z"
                p-id="5476"
                fill="#777777"
              ></path>
              <path
                d="M672.225703 489.88533c-0.541329 0-1.083681-0.026606-1.639337-0.094144-7.610328-0.89437-13.041014-7.78736-12.147668-15.398712 3.5345-30.03813-9.384741-59.792804-33.722032-77.66894-6.175653-4.523013-7.502881-13.204743-2.978844-19.380396 4.536316-6.161327 13.218046-7.489578 19.392676-2.965541 32.368198 23.768333 49.553603 63.327304 44.854581 103.265922C685.145967 484.698191 679.159626 489.88533 672.225703 489.88533z"
                p-id="5477"
                fill="#777777"
              ></path>
            </svg>
            专辑
          </span>
        </span>
        <span class="search-right">
          <span
            class="search-info search-span"
            v-for="item in getAlbums"
            :key="item.id"
          >
            <span slot="title" class="artist-name" v-html="byShow(item)"></span>
          </span>
        </span>
      </div>
      <!-- 歌单 -->
      <div class="search-sing" v-if="getPlayLists.length > 0">
        <span class="search-left">
          <span class="search-title">
            <svg
              t="1650435350759"
              class="icon"
              viewBox="0 0 1024 1024"
              version="1.1"
              xmlns="http://www.w3.org/2000/svg"
              p-id="6401"
              width="12"
              height="12"
            >
              <path
                d="M964.608 234.496c-46.08-52.565333-104.789333-93.696-169.642667-118.784a34.030933 34.030933 0 0 0-46.421333 31.744v420.352a178.005333 178.005333 0 0 0-110.933333-38.741333c-98.816 0-179.2 80.384-179.2 179.2S538.794667 887.466667 637.610667 887.466667s179.2-80.384 179.2-179.2c0-1.877333-0.170667-3.754667-0.341334-5.632 0-1.024 0.341333-1.877333 0.341334-2.901334V201.216c36.181333 20.309333 69.12 46.933333 96.597333 78.165333 12.458667 14.165333 34.133333 15.530667 48.128 3.072 14.165333-12.288 15.530667-33.792 3.072-47.957333zM637.610667 819.2c-61.098667 0-110.933333-49.834667-110.933334-110.933333s49.834667-110.933333 110.933334-110.933334 110.933333 49.834667 110.933333 110.933334-49.834667 110.933333-110.933333 110.933333zM185.344 307.2h392.533333c18.773333 0 34.133333-15.36 34.133334-34.133333s-15.36-34.133333-34.133334-34.133334h-392.533333a34.133333 34.133333 0 1 0 0 68.266667zM424.277333 460.8h-238.933333c-18.773333 0-34.133333 15.36-34.133333 34.133333s15.36 34.133333 34.133333 34.133334h238.933333c18.773333 0 34.133333-15.36 34.133334-34.133334s-15.36-34.133333-34.133334-34.133333zM321.877333 682.666667h-136.533333c-18.773333 0-34.133333 15.36-34.133333 34.133333s15.36 34.133333 34.133333 34.133333h136.533333c18.773333 0 34.133333-15.36 34.133334-34.133333s-15.36-34.133333-34.133334-34.133333z"
                p-id="6402"
                fill="#777777"
              ></path>
            </svg>
            歌单
          </span>
        </span>
        <span class="search-right">
          <span
            class="search-info search-span"
            v-for="item in getPlayLists"
            :key="item.id"
          >
            <span slot="title" class="artist-name" v-html="byShow(item)"></span>
          </span>
        </span>
      </div>
    </div>
  </div>
</template>

<script>
import { mapGetters } from "vuex";
export default {
  name: "Search",
  props: ["keyword"],
  data() {
    return {
      // 控制显示搜索建议
      isSearchProp: false,
      // 搜索请求返回的数据 albums(专辑) artists（歌手） order（顺序） playlists（歌单） songs（单曲）
    };
  },
  computed: {
    // 获取vuex中的搜索建议的各个数据
    ...mapGetters(["getSongs", "getArtists", "getAlbums", "getPlayLists"]),
    // 搜索建议作者返回
    byShow(item) {
      return (item) => {
        let allname = ""; //整条数据
        let byname = ""; //作者名字
        let rapname = item.name; //搜索的名字
        // 获取四种搜索类别的作者名字
        if (item.artists && item.artists.length > 0) {
          item.artists.forEach((sub) => {
            byname += `${sub.name} `;
          });
        } else {
          // 如果传入的item该类别没有相同的属性，就找另一个属性
          byname = item.artist ? item.artist.name : "";
        }
        // 高亮
        const highlightStr = `<span style="color:red;">${this.keyword}</span>`;
        const reg = new RegExp(this.keyword, "gi");
        rapname = rapname.replace(reg, highlightStr);
        byname = byname.replace(reg, highlightStr);
        // 拼接整条数据
        allname = `${rapname}${byname ? "-" : ""}${byname}`;
        return allname;
      };
    },
  },
  methods: {
    searching() {
      if (this.keyword) {
        this.$store.dispatch("search", this.keyword);
        this.isSearchProp = true;
      } else {
          this.isSearchProp = false;
      }
    },
    searchFocus() {
      if (this.keyword) {
        this.isSearchProp = true;
      }
    },
    searchBlur() {
      this.isSearchProp = false;
    },
  },
};
</script>

<style lang="less" scoped>
.search-prop {
  border-radius: 5px;
  background: #fff;
  border: 1px solid #777;
  margin-left: 30px;
  position: absolute;
  width: 280px;
  left: 50%;
  top: 60px;
  z-index: 999;
  font-size: 12px;
  color: #777;
  text-align: left;
  transform: translateX(-50%);
  .search-body {
    color: #000;
  }
  .search-div {
    height: 45px;
    line-height: 45px;
    padding: 0 10px;
  }
  .search-span {
    height: 30px;
    line-height: 30px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    padding-left: 10px;
  }
  .search-header {
    border-bottom: 1px solid #ccc;
  }
  .search-sing {
    display: flex;
    &:nth-child(2n) .search-right {
      background: #f9f8f8;
    }
    /deep/.search-left {
      display: flex;
      align-items: flex-start;
      border-right: 1px solid #ccc;
      .search-title {
        text-align: center;
        padding: 0 5px;
        height: 30px;
        line-height: 30px;
      }
    }
    .search-right {
      display: flex;
      flex-direction: column;
      &:last-child {
        border-bottom: 1px solid #ccc;
      }
      .search-info {
        display: block;
        width: 227px;
        &:hover {
          background: #ccc;
          cursor: pointer;
        }
      }
    }
  }
}
</style>